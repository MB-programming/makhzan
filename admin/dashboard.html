<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>لوحة التحكم | مخازن العناية</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <link rel="stylesheet" href="assets/css/admin.css" />
</head>
<body class="dashboard-page">

<!-- ============================================================
  SIDEBAR
============================================================ -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <img src="../logo-white.png" alt="مخازن العناية" class="sidebar-logo" />
  </div>

  <nav class="sidebar-nav">
    <button class="nav-item active" data-tab="branches">
      <i class="fas fa-map-marker-alt"></i>
      <span>الفروع</span>
      <span class="nav-badge" id="badge-branches">0</span>
    </button>
    <button class="nav-item" data-tab="brands">
      <i class="fas fa-tags"></i>
      <span>البراندات</span>
      <span class="nav-badge" id="badge-brands">0</span>
    </button>
    <button class="nav-item" data-tab="social">
      <i class="fas fa-share-alt"></i>
      <span>التواصل الاجتماعي</span>
      <span class="nav-badge" id="badge-social">0</span>
    </button>
    <button class="nav-item" data-tab="contact">
      <i class="fas fa-phone-alt"></i>
      <span>معلومات التواصل</span>
    </button>
    <button class="nav-item" data-tab="articles">
      <i class="fas fa-newspaper"></i>
      <span>المقالات</span>
      <span class="nav-badge" id="badge-articles">0</span>
    </button>
    <button class="nav-item" data-tab="tracking">
      <i class="fab fa-google"></i>
      <span>كودات التتبع</span>
    </button>
  </nav>

  <div class="sidebar-footer">
    <a href="../index.html" class="sidebar-link" target="_blank">
      <i class="fas fa-external-link-alt"></i> عرض الموقع
    </a>
    <button class="sidebar-link logout-btn" id="logout-btn">
      <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
    </button>
  </div>
</aside>

<!-- Overlay for mobile -->
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<!-- ============================================================
  MAIN CONTENT
============================================================ -->
<div class="main-content" id="main-content">

  <!-- Top Bar -->
  <header class="topbar">
    <button class="menu-toggle" id="menu-toggle">
      <i class="fas fa-bars"></i>
    </button>
    <div class="topbar-title" id="topbar-title">الفروع</div>
    <div class="topbar-user">
      <span class="user-name" id="user-name">...</span>
      <div class="user-avatar"><i class="fas fa-user"></i></div>
    </div>
  </header>

  <!-- Content Area -->
  <div class="content-area">

    <!-- ======= BRANCHES TAB ======= -->
    <div id="tab-branches" class="tab-content active">
      <div class="tab-toolbar">
        <div class="toolbar-left">
          <h2 class="tab-title">إدارة الفروع</h2>
          <span class="count-label" id="branches-count"></span>
        </div>
        <button class="btn-add" onclick="openModal('branch')">
          <i class="fas fa-plus"></i> إضافة فرع
        </button>
      </div>
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="بحث في الفروع..." oninput="filterTable('branches-table', this.value)" />
      </div>
      <div class="table-wrap">
        <table class="data-table" id="branches-table">
          <thead>
            <tr>
              <th>#</th>
              <th>الاسم (عربي)</th>
              <th>المدينة</th>
              <th>رقم الهاتف</th>
              <th>الحالة</th>
              <th>الإجراءات</th>
            </tr>
          </thead>
          <tbody id="branches-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ======= BRANDS TAB ======= -->
    <div id="tab-brands" class="tab-content">
      <div class="tab-toolbar">
        <div class="toolbar-left">
          <h2 class="tab-title">إدارة البراندات</h2>
          <span class="count-label" id="brands-count"></span>
        </div>
        <button class="btn-add" onclick="openModal('brand')">
          <i class="fas fa-plus"></i> إضافة براند
        </button>
      </div>
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="بحث في البراندات..." oninput="filterTable('brands-table', this.value)" />
      </div>
      <div class="table-wrap">
        <table class="data-table" id="brands-table">
          <thead>
            <tr>
              <th>#</th>
              <th>الشعار</th>
              <th>الاسم (إنجليزي)</th>
              <th>الاسم (عربي)</th>
              <th>الحالة</th>
              <th>الإجراءات</th>
            </tr>
          </thead>
          <tbody id="brands-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ======= SOCIAL TAB ======= -->
    <div id="tab-social" class="tab-content">
      <div class="tab-toolbar">
        <div class="toolbar-left">
          <h2 class="tab-title">منصات التواصل الاجتماعي</h2>
          <span class="count-label" id="social-count"></span>
        </div>
        <button class="btn-add" onclick="openModal('social')">
          <i class="fas fa-plus"></i> إضافة منصة
        </button>
      </div>
      <div class="table-wrap">
        <table class="data-table" id="social-table">
          <thead>
            <tr>
              <th>#</th>
              <th>المنصة</th>
              <th>المنصة (عربي)</th>
              <th>اسم المستخدم</th>
              <th>الرابط</th>
              <th>الحالة</th>
              <th>الإجراءات</th>
            </tr>
          </thead>
          <tbody id="social-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ======= CONTACT TAB ======= -->
    <div id="tab-contact" class="tab-content">
      <div class="tab-toolbar">
        <div class="toolbar-left">
          <h2 class="tab-title">معلومات التواصل</h2>
        </div>
        <button class="btn-add" onclick="openModal('contact')">
          <i class="fas fa-plus"></i> إضافة معلومة
        </button>
      </div>
      <div class="table-wrap">
        <table class="data-table" id="contact-table">
          <thead>
            <tr>
              <th>#</th>
              <th>النوع</th>
              <th>القيمة</th>
              <th>التسمية</th>
              <th>الحالة</th>
              <th>الإجراءات</th>
            </tr>
          </thead>
          <tbody id="contact-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ======= ARTICLES TAB ======= -->
    <div id="tab-articles" class="tab-content">
      <div class="tab-toolbar">
        <div class="toolbar-left">
          <h2 class="tab-title">إدارة المقالات</h2>
          <span class="count-label" id="articles-count"></span>
        </div>
        <button class="btn-add" onclick="openArticleModal()">
          <i class="fas fa-plus"></i> إضافة مقال
        </button>
      </div>
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="بحث في المقالات..." oninput="filterTable('articles-table', this.value)" />
      </div>
      <div class="table-wrap">
        <table class="data-table" id="articles-table">
          <thead>
            <tr>
              <th>#</th>
              <th>العنوان</th>
              <th>الفئة</th>
              <th>مميز</th>
              <th>الحالة</th>
              <th>تاريخ النشر</th>
              <th>الإجراءات</th>
            </tr>
          </thead>
          <tbody id="articles-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ======= TRACKING TAB ======= -->
    <div id="tab-tracking" class="tab-content">
      <div class="tab-toolbar">
        <div class="toolbar-left">
          <h2 class="tab-title">كودات التتبع والتحليل</h2>
        </div>
        <button class="btn-add" onclick="saveTrackingCodes()">
          <i class="fas fa-save"></i> حفظ الكودات
        </button>
      </div>

      <!-- Hints -->
      <div class="tracking-hints">
        <div class="hint-card">
          <i class="fab fa-google"></i>
          <div>
            <strong>Google Analytics</strong>
            <p>الصق كود gtag.js أو GA4 في خانة كود الهيدر</p>
          </div>
        </div>
        <div class="hint-card">
          <i class="fab fa-facebook-f"></i>
          <div>
            <strong>Meta / Facebook Pixel</strong>
            <p>الصق كود البيكسل في خانة كود الهيدر</p>
          </div>
        </div>
        <div class="hint-card">
          <i class="fas fa-tag"></i>
          <div>
            <strong>Google Tag Manager</strong>
            <p>كود الـ &lt;script&gt; في الهيدر، وكود الـ &lt;noscript&gt; في البودي</p>
          </div>
        </div>
        <div class="hint-card">
          <i class="fas fa-chart-line"></i>
          <div>
            <strong>أي كود تتبع آخر</strong>
            <p>TikTok Pixel, Snapchat Pixel, X Pixel...</p>
          </div>
        </div>
      </div>

      <div class="tracking-form">
        <!-- Header Code -->
        <div class="tracking-block">
          <div class="tracking-block-header">
            <div class="tracking-block-icon"><i class="fas fa-code"></i></div>
            <div>
              <h3>كود الـ &lt;head&gt;</h3>
              <p>يُحقن مباشرة داخل &lt;head&gt; في الموقع</p>
            </div>
          </div>
          <textarea id="header_code" class="code-textarea" rows="10"
            placeholder="<!-- Google Analytics -->\n<script async src='https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX'></script>\n<script>\n  window.dataLayer = window.dataLayer || [];\n  function gtag(){dataLayer.push(arguments);}\n  gtag('js', new Date());\n  gtag('config', 'G-XXXXXXXXXX');\n</script>"></textarea>
        </div>

        <!-- Body Code -->
        <div class="tracking-block">
          <div class="tracking-block-header">
            <div class="tracking-block-icon"><i class="fas fa-code"></i></div>
            <div>
              <h3>كود الـ &lt;body&gt;</h3>
              <p>يُحقن في بداية &lt;body&gt; في الموقع (للـ noscript)</p>
            </div>
          </div>
          <textarea id="body_code" class="code-textarea" rows="6"
            placeholder="<!-- Google Tag Manager (noscript) -->\n<noscript><iframe src='https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX' height='0' width='0' style='display:none;visibility:hidden'></iframe></noscript>"></textarea>
        </div>
      </div>
    </div>

  </div><!-- /content-area -->
</div><!-- /main-content -->

<!-- ============================================================
  ARTICLE MODAL
============================================================ -->
<div class="modal-overlay" id="article-modal-overlay">
  <div class="modal" id="article-modal" style="max-width:760px;width:95%">
    <div class="modal-header">
      <h3 class="modal-title" id="article-modal-title">إضافة مقال</h3>
      <button class="modal-close" onclick="closeArticleModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body" style="max-height:70vh;overflow-y:auto">
      <form id="article-form" onsubmit="return false">
        <input type="hidden" id="article-id" value="" />

        <div class="form-grid-2">
          <div class="form-group" style="grid-column:1/-1">
            <label>العنوان <span style="color:red">*</span></label>
            <input type="text" id="af-title" placeholder="عنوان المقال" required />
          </div>
          <div class="form-group">
            <label>الفئة</label>
            <input type="text" id="af-category" placeholder="مثال: جمال، عناية بالبشرة..." />
          </div>
          <div class="form-group">
            <label>تاريخ النشر</label>
            <input type="datetime-local" id="af-published_at" />
          </div>
          <div class="form-group" style="grid-column:1/-1">
            <label>الوصف المختصر (مقتطف)</label>
            <textarea id="af-excerpt" rows="3" placeholder="وصف قصير يظهر في قائمة المقالات..."></textarea>
          </div>
          <div class="form-group" style="grid-column:1/-1">
            <label>المحتوى الكامل (HTML)</label>
            <textarea id="af-body" rows="10" placeholder="<p>محتوى المقال...</p>" style="font-family:monospace;font-size:13px"></textarea>
          </div>
          <div class="form-group" style="grid-column:1/-1">
            <label>رابط صورة الغلاف</label>
            <input type="url" id="af-cover_image" placeholder="https://..." />
          </div>
          <div class="form-group">
            <label>الوسوم (Tags)</label>
            <input type="text" id="af-tags" placeholder="جمال, عناية, بشرة" />
          </div>
          <div class="form-group">
            <label>الكاتب</label>
            <input type="text" id="af-author_name" placeholder="مخازن العناية" />
          </div>
          <div class="form-group" style="grid-column:1/-1;display:flex;gap:20px;align-items:center;padding-top:8px">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;margin:0">
              <input type="checkbox" id="af-is_active" checked style="width:18px;height:18px;accent-color:var(--gold)" />
              <span>مفعّل (يظهر للزوار)</span>
            </label>
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;margin:0">
              <input type="checkbox" id="af-is_featured" style="width:18px;height:18px;accent-color:var(--gold)" />
              <span>مقال مميز (يظهر أولاً)</span>
            </label>
          </div>
        </div>

        <!-- SEO (collapsible) -->
        <details style="margin-top:16px;border:1px solid var(--border-color,#e5e3dc);border-radius:10px;padding:16px">
          <summary style="cursor:pointer;font-weight:700;color:var(--text-primary,#1a1a1a)">
            <i class="fas fa-search" style="margin-left:6px"></i> إعدادات SEO (اختياري)
          </summary>
          <div class="form-grid-2" style="margin-top:16px">
            <div class="form-group" style="grid-column:1/-1">
              <label>عنوان SEO</label>
              <input type="text" id="af-seo_title" placeholder="مختلف عن عنوان المقال..." />
            </div>
            <div class="form-group" style="grid-column:1/-1">
              <label>وصف SEO</label>
              <textarea id="af-seo_description" rows="2" placeholder="وصف يظهر في نتائج البحث..."></textarea>
            </div>
            <div class="form-group" style="grid-column:1/-1">
              <label>كلمات مفتاحية</label>
              <input type="text" id="af-seo_keywords" placeholder="كلمة1, كلمة2, كلمة3" />
            </div>
          </div>
        </details>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeArticleModal()">إلغاء</button>
      <button class="btn-save" onclick="saveArticle()">
        <i class="fas fa-save"></i> حفظ المقال
      </button>
    </div>
  </div>
</div>

<!-- ============================================================
  MODAL
============================================================ -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal" id="modal">
    <div class="modal-header">
      <h3 class="modal-title" id="modal-title">إضافة</h3>
      <button class="modal-close" onclick="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body" id="modal-body">
      <!-- Dynamic form injected by JS -->
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeModal()">إلغاء</button>
      <button class="btn-save" id="modal-save-btn" onclick="saveRecord()">
        <i class="fas fa-save"></i> حفظ
      </button>
    </div>
  </div>
</div>

<!-- ============================================================
  CONFIRM DELETE DIALOG
============================================================ -->
<div class="modal-overlay" id="confirm-overlay">
  <div class="modal confirm-modal">
    <div class="confirm-icon"><i class="fas fa-exclamation-triangle"></i></div>
    <h3>تأكيد الحذف</h3>
    <p>هل أنت متأكد من حذف هذا العنصر؟ لا يمكن التراجع عن هذا الإجراء.</p>
    <div class="confirm-actions">
      <button class="btn-cancel" onclick="closeConfirm()">إلغاء</button>
      <button class="btn-delete-confirm" id="confirm-delete-btn">
        <i class="fas fa-trash"></i> حذف
      </button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Admin JS -->
<script src="assets/js/admin.js"></script>
</body>
</html>
